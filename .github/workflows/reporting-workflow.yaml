name: Jira Vuln Management Reporting Workflow

on:
  workflow_call:
    inputs:
      artifact-name:
        required: true
        type: string
    secrets:
      env-api-host:
        required: true
      env-jira-access-token:
        required: true

jobs:
  jira-vuln-reporting:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v3
        with:
          repository: breaktoprotect/jira-vuln-mgmt
          ref: bugfix/scan_results

      - uses: actions/download-artifact@v3
        with:
          name: ${{ inputs.artifact-name }}
          
      - name: debug
        run: echo ${{ github.ref }}

      - name: Python script to report findings from trivy-results.sarif
        run: python3 sarif_to_jira_action.py -f ${{ inputs.artifact-name }} -c ${{ github.repository }}@${{ github.ref_name }} -r jeremyspk@gmail.com
        env:
          API_ACCESS_TOKEN: ${{ secrets.env-jira-access-token }}
          API_HOSTNAME: ${{ secrets.env-api-host }}